[
  {
    "description": "should reject malformed full URI",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_FULL_URI": "192.168.1.1"
    },
    "expect": {
      "type": "error",
      "reason": "'192.168.1.1' must be a valid HTTP or HTTPS URI"
    }
  },
  {
    "description": "should reject forbidden host in full URI",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_FULL_URI": "http://192.168.1.1/endpoint"
    },
    "expect": {
      "type": "error",
      "reason": "'192.168.1.1' is not an allowed host"
    }
  },
  {
    "description": "should reject invalid token file path",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_RELATIVE_URI": "/endpoint",
      "AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE": "/full/path/to/token/file",
      "AWS_CONTAINER_AUTHORIZATION_TOKEN": "footoken2"
    },
    "token_file": {
      "type": "error",
      "errno": "ENOENT"
    },
    "expect": {
      "type": "error",
      "reason": "failed to read authorization token from '/full/path/to/token/file': no such file or directory"
    }
  },
  {
    "description": "https URI",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_FULL_URI": "https://awscredentials.amazonaws.com/credentials"
    },
    "expect": {
      "type": "success",
      "request": {
        "method": "GET",
        "uri": "https://awscredentials.amazonaws.com/credentials",
        "headers": {}
      }
    }
  },
  {
    "description": "http loopback(v4) URI",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_FULL_URI": "http://127.0.0.2/credentials"
    },
    "expect": {
      "type": "success",
      "request": {
        "method": "GET",
        "uri": "http://127.0.0.2/credentials",
        "headers": {}
      }
    }
  },
  {
    "description": "http link-local(v4) URI",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_FULL_URI": "http://169.254.0.2/credentials"
    },
    "expect": {
      "type": "success",
      "request": {
        "method": "GET",
        "uri": "http://169.254.0.2/credentials",
        "headers": {}
      }
    }
  },
  {
    "description": "http loopback(v6) URI",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_FULL_URI": "http://[::1]/credentials"
    },
    "expect": {
      "type": "success",
      "request": {
        "method": "GET",
        "uri": "http://[::1]/credentials",
        "headers": {}
      }
    }
  },
  {
    "description": "http link-local(v6) URI",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_FULL_URI": "http://[fe80::2]/credentials"
    },
    "expect": {
      "type": "success",
      "request": {
        "method": "GET",
        "uri": "http://[fe80::2]/credentials",
        "headers": {}
      }
    }
  },
  {
    "description": "complex full URI",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_FULL_URI": "http://127.0.0.1:8080/credentials?foo=bar%20baz"
    },
    "expect": {
      "type": "success",
      "request": {
        "method": "GET",
        "uri": "http://127.0.0.1:8080/credentials?foo=bar%20baz",
        "headers": {}
      }
    }
  },
  {
    "description": "relative URI, ignore full URI",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_RELATIVE_URI": "/credentials-relative?foo=bar%20baz",
      "AWS_CONTAINER_CREDENTIALS_FULL_URI": "http://127.0.0.1:8080/credentials?foo=bar%20baz"
    },
    "expect": {
      "type": "success",
      "request": {
        "method": "GET",
        "uri": "http://169.254.170.2/credentials-relative?foo=bar%20baz",
        "headers": {}
      }
    }
  },
  {
    "description": "auth token from file",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_RELATIVE_URI": "/credentials-relative",
      "AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE": "/path/to/token",
      "AWS_CONTAINER_AUTHORIZATION_TOKEN": "static%20token2"
    },
    "token_file": {
      "type": "success",
      "content": "static%20token"
    },
    "expect": {
      "type": "success",
      "request": {
        "method": "GET",
        "uri": "http://169.254.170.2/credentials-relative",
        "headers": {
          "Authorization": "static%20token"
        }
      }
    }
  },
  {
    "description": "auth token from env",
    "env": {
      "AWS_CONTAINER_CREDENTIALS_RELATIVE_URI": "/credentials-relative",
      "AWS_CONTAINER_AUTHORIZATION_TOKEN": "static%20token2"
    },
    "expect": {
      "type": "success",
      "request": {
        "method": "GET",
        "uri": "http://169.254.170.2/credentials-relative",
        "headers": {
          "Authorization": "static%20token2"
        }
      }
    }
  }
]